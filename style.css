document.getElementById("generateButton").addEventListener("click", async () => {
    const artistaNome = document.getElementById("artistaNome").value;
    const artistaAlias = document.getElementById("artistaAlias").value;
    const luogoNascita = document.getElementById("luogoNascita").value;
    const dataNascita = document.getElementById("dataNascita").value;
    const traccePerAlbum = document.getElementById("traccePerAlbum").value;
    const durataContratto = document.getElementById("durataContratto").value;
    const percentualeRoyalty = document.getElementById("percentualeRoyalty").value;
    const obblighiLabel = document.getElementById("obblighiLabel").value;
    const obblighiArtista = document.getElementById("obblighiArtista").value;

    // Aggiorna l'anteprima del contratto
    document.getElementById("previewArtistaNome").innerText = artistaNome;
    document.getElementById("previewArtistaAlias").innerText = artistaAlias;
    document.getElementById("previewLuogoNascita").innerText = luogoNascita;
    document.getElementById("previewDataNascita").innerText = dataNascita;
    document.getElementById("previewTraccePerAlbum").innerText = traccePerAlbum;
    document.getElementById("previewDurataContratto").innerText = durataContratto;
    document.getElementById("previewPercentualeRoyalty").innerText = percentualeRoyalty;
    document.getElementById("previewObblighiLabel").innerText = obblighiLabel;
    document.getElementById("previewObblighiArtista").innerText = obblighiArtista;

    // Mostra l'anteprima
    const contractPreview = document.getElementById("contractPreview");
    contractPreview.style.display = "block";

    // Cattura l'immagine dell'anteprima e caricala su imgbb
    html2canvas(contractPreview).then(async (canvas) => {
        const imageData = canvas.toDataURL("image/png");

        const formData = new FormData();
        formData.append("image", imageData.split(",")[1]); // Rimuovi la parte "data:image/png;base64,"

        // Chiamata API a imgbb
        try {
            const response = await fetch(`https://api.imgbb.com/1/upload?key=2970b606faf3351a85bd7467ab5efd5b`, {
                method: "POST",
                body: formData,
            });
            const result = await response.json();
            if (result.success) {
                alert(`Immagine caricata con successo! Link: ${result.data.url}`);
            } else {
                alert("Errore nel caricamento dell'immagine.");
            }
        } catch (error) {
            alert("Errore nella chiamata a imgbb.");
        }
    });
});
